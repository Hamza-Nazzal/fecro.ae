{
  "version": 3,
  "sources": ["../bundle-4PRCGm/checked-fetch.js", "wrangler-modules-watch:wrangler:modules-watch", "../../../../../../../../opt/homebrew/lib/node_modules/wrangler/templates/modules-watch-stub.js", "../../../src/lib/supabase.js", "../../../src/mappers/sellerRfqCardMapper.js", "../../../src/enrichment/enrichRfqCardRows.js", "../../../src/mappers/sellerHydrateMapper.js", "../../../src/services/sellerRfqService.js", "../bundle-4PRCGm/middleware-loader.entry.ts", "../bundle-4PRCGm/middleware-insertion-facade.js", "../../../src/index.js", "../../../src/utils/response.js", "../../../src/utils/cors.js", "../../../src/lib/auth.js", "../../../src/handlers/seller.js", "../../../src/handlers/company.js", "../../../src/handlers/buyerRfq.js", "../../../../../../../../opt/homebrew/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../../../../opt/homebrew/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../../../../../../../../opt/homebrew/lib/node_modules/wrangler/templates/middleware/common.ts"],
  "sourceRoot": "/Users/hamzanazzal/Desktop/fecro.ae/hubgate-api/.wrangler/tmp/dev-QDVPs7",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "", "// `esbuild` doesn't support returning `watch*` options from `onStart()`\n// plugin callbacks. Instead, we define an empty virtual module that is\n// imported by this injected file. Importing the module registers watchers.\nimport \"wrangler:modules-watch\";\n", "// hubgate-api/src/lib/supabase.js\n\nexport async function supaPOSTService(env, table, rows) {\n  const url = `${env.SUPABASE_URL}/rest/v1/${table}`;\n\n  const res = await fetch(url, {\n    method: \"POST\",\n    headers: {\n      apikey: env.SUPABASE_SERVICE_KEY,\n      authorization: `Bearer ${env.SUPABASE_SERVICE_KEY}`,\n      \"content-type\": \"application/json\",\n      prefer: \"return=representation\",\n    },\n    body: JSON.stringify(Array.isArray(rows) ? rows : [rows]),\n  });\n\n  if (!res.ok) {\n    const text = await res.text().catch(() => \"\");\n    throw new Error(`Supabase POST ${table} failed ${res.status}: ${text}`);\n  }\n\n  return res.json();\n}\n\nexport async function supaGETService(env, path) {\n  const url = `${env.SUPABASE_URL}/rest/v1/${path}`;\n\n  const res = await fetch(url, {\n    headers: {\n      apikey: env.SUPABASE_SERVICE_KEY,\n      authorization: `Bearer ${env.SUPABASE_SERVICE_KEY}`,\n      accept: \"application/json\",\n    },\n  });\n\n  const text = await res.text().catch(() => \"\");\n  if (!res.ok) {\n    throw new Error(`Supabase GET failed ${res.status}: ${text}`);\n  }\n\n  let json;\n  try { json = text ? JSON.parse(text) : []; } catch { json = []; }\n  return { data: json, error: null };\n}\n\nexport async function supaPATCHService(env, table, rowId, patch) {\n  const url = `${env.SUPABASE_URL}/rest/v1/${table}?id=eq.${encodeURIComponent(rowId)}`;\n\n  const res = await fetch(url, {\n    method: \"PATCH\",\n    headers: {\n      apikey: env.SUPABASE_SERVICE_KEY,\n      authorization: `Bearer ${env.SUPABASE_SERVICE_KEY}`,\n      \"content-type\": \"application/json\",\n      prefer: \"return=representation\",\n    },\n    body: JSON.stringify(patch || {}),\n  });\n\n  const text = await res.text();\n  let json; try { json = text ? JSON.parse(text) : null; } catch { json = { raw: text }; }\n\n  if (!res.ok) throw new Error(`Supabase PATCH ${table} failed ${res.status}: ${text}`);\n\n  return { data: Array.isArray(json) ? json : [json], error: null };\n}\n\nexport async function supaGETWithUser(env, table, qs, userJWT) {\n  const clean = String(qs || \"\").replace(/^\\?+/, \"\");\n  const url = `${env.SUPABASE_URL}/rest/v1/${table}?${clean}`;\n\n  // console.log(\"POSTGREST GET:\", url);\n\n  const res = await fetch(url, {\n    headers: {\n      apikey: env.SUPABASE_ANON_KEY,\n      authorization: `Bearer ${userJWT}`,\n      accept: \"application/json\",\n    },\n  });\n\n  const text = await res.text();\n  let json; try { json = text ? JSON.parse(text) : null; } catch { json = { raw: text }; }\n\n  if (!res.ok) throw new Error(`Supabase GET ${table} failed ${res.status}: ${text}`);\n\n  return { status: res.status, json };\n}", "// hubgate-api/src/mappers/sellerRfqCardMapper.js\n// Convert snake_case \u2192 camelCase for seller RFQ cards\n\nexport function mapSellerRfqCard(row = {}) {\n  if (!row) return null;\n\n  const companyCity = row.company_city ?? null;\n  const companyState = row.company_state ?? null;\n  const companyCountry = row.company_country ?? null;\n\n  const result = {\n    id: row.id ?? null,\n    publicId: row.public_id ?? row.id ?? null,\n    sellerRfqId: row.seller_rfq_id ?? null,\n    title: row.title ?? row.public_id ?? \"RFQ\",\n    status: row.status ?? \"active\",\n    postedAt: row.created_at ?? null,\n    categoryPath: row.first_category_path ?? row.category_path ?? \"\",\n    quotationsCount: Number(\n      row.quotations_count ??\n      row.quotes_count ??\n      row.quotationsCount ??\n      0\n    ),\n    itemsCount: Number(row.items_count ?? 0),\n    itemsPreview: Array.isArray(row.items_preview) ? row.items_preview : [],\n    itemsSummary: Array.isArray(row.items_summary) ? row.items_summary : [],\n    itemsTotalCount: typeof row.items_total_count === \"number\" ? row.items_total_count : null,\n    itemsOverflowCount: typeof row.items_overflow_count === \"number\" ? row.items_overflow_count : null,\n    // Pass through raw fields for backward compatibility\n    company_city: companyCity,\n    company_state: companyState,\n    company_country: companyCountry,\n  };\n\n  // Only include companyLocation if at least one field is non-null\n  if (companyCity != null || companyState != null || companyCountry != null) {\n    result.companyLocation = {\n      city: companyCity,\n      state: companyState,\n      country: companyCountry,\n    };\n  }\n\n  return result;\n}\n\n", "// hubgate-api/src/enrichment/enrichRfqCardRows.js\n// Worker-compatible version of enrichment logic\n\nimport { supaGETService } from \"../lib/supabase.js\";\n\n// Helper: fetch quotation counts for RFQ IDs\nasync function fetchQuotationCounts(env, rfqIds = []) {\n  if (!Array.isArray(rfqIds) || rfqIds.length === 0) return new Map();\n  const uniqueIds = [...new Set(rfqIds.filter(Boolean))];\n  if (!uniqueIds.length) return new Map();\n\n  try {\n    const path = `quotations?rfq_id=in.(${uniqueIds.join(\",\")})&select=rfq_id`;\n    const { data } = await supaGETService(env, path);\n    const counts = new Map();\n    for (const row of data || []) {\n      const id = row?.rfq_id;\n      if (!id) continue;\n      counts.set(id, (counts.get(id) || 0) + 1);\n    }\n    return counts;\n  } catch {\n    return new Map();\n  }\n}\n\n// Helper: fetch items preview/summary data\nasync function fetchItemsPreviewData(env, rfqIds = []) {\n  if (!Array.isArray(rfqIds) || rfqIds.length === 0) {\n    return { previewMap: new Map(), summaryMap: new Map() };\n  }\n  const uniqueIds = [...new Set(rfqIds.filter(Boolean))];\n  if (!uniqueIds.length) return { previewMap: new Map(), summaryMap: new Map() };\n\n  try {\n    // Fetch items\n    const itemsPath = `rfq_items?rfq_id=in.(${uniqueIds.join(\",\")})&select=id,rfq_id,product_name,quantity,category_path&order=created_at.asc`;\n    const { data: items } = await supaGETService(env, itemsPath);\n    if (!Array.isArray(items)) return { previewMap: new Map(), summaryMap: new Map() };\n\n    const itemIds = items.map((it) => it?.id).filter(Boolean);\n    const specsByItem = new Map();\n\n    // Fetch specs if items exist\n    if (itemIds.length) {\n      try {\n        const specsPath = `rfq_item_specs?rfq_item_id=in.(${itemIds.join(\",\")})&select=rfq_item_id,key_label,key_norm,value,unit`;\n        const { data: specs } = await supaGETService(env, specsPath);\n        if (Array.isArray(specs)) {\n          for (const spec of specs) {\n            if (!spec) continue;\n            const list = specsByItem.get(spec.rfq_item_id) || [];\n            list.push(spec);\n            specsByItem.set(spec.rfq_item_id, list);\n          }\n        }\n      } catch {\n        // Non-fatal\n      }\n    }\n\n    // Build preview and summary maps\n    const previewMap = new Map();\n    const summaryMap = new Map();\n    const itemsCountMap = new Map(); // Track total items per RFQ\n\n    // First pass: count total items per RFQ\n    for (const item of items) {\n      if (!item?.rfq_id) continue;\n      const rfqId = item.rfq_id;\n      itemsCountMap.set(rfqId, (itemsCountMap.get(rfqId) || 0) + 1);\n    }\n\n    // Second pass: build preview and summary (limit to 10 items)\n    for (const item of items) {\n      if (!item?.rfq_id) continue;\n      const rfqId = item.rfq_id;\n      const specRows = specsByItem.get(item.id) || [];\n\n      // Simple preview: product name\n      const preview = item.product_name?.trim();\n      if (preview) {\n        const previews = previewMap.get(rfqId) || [];\n        if (!previews.includes(preview)) previews.push(preview);\n        previewMap.set(rfqId, previews);\n      }\n\n      // Simple summary entry\n      const summaryEntry = {\n        name: item.product_name?.trim() || \"Item\",\n        qty: Number(item.quantity) || null,\n        categoryPath: item.category_path?.trim() || \"\",\n        specifications: {},\n      };\n      \n      // Add first 10 specs\n      for (const spec of specRows.slice(0, 10)) {\n        const label = (spec.key_label || spec.key_norm || \"\").trim();\n        const value = (spec.value || \"\").toString().trim();\n        if (label && value) {\n          const display = spec.unit ? `${value} ${spec.unit}`.trim() : value;\n          summaryEntry.specifications[label] = display;\n        }\n      }\n\n      const summary = summaryMap.get(rfqId) || [];\n      if (summary.length < 10) {\n        summary.push(summaryEntry);\n        summaryMap.set(rfqId, summary);\n      }\n    }\n\n    return { previewMap, summaryMap, itemsCountMap };\n  } catch {\n    return { previewMap: new Map(), summaryMap: new Map() };\n  }\n}\n\n// Main enrichment function\nexport async function enrichRfqCardRows(env, rows = []) {\n  if (!Array.isArray(rows) || rows.length === 0) return [];\n\n  const rfqIds = rows.map((row) => row?.id).filter(Boolean);\n  \n  // Check what's missing\n  const needsQuotes = rows.some((row) => typeof row?.quotations_count !== \"number\");\n  const needsPreview = rows.some((row) => {\n    const arr = Array.isArray(row?.items_preview) ? row.items_preview : [];\n    return arr.length === 0;\n  });\n  const needsSummary = rows.some((row) => {\n    const arr = Array.isArray(row?.items_summary) ? row.items_summary : [];\n    return arr.length === 0;\n  });\n\n  // Fetch in parallel\n  const [quotesMap, itemsData] = await Promise.all([\n    needsQuotes ? fetchQuotationCounts(env, rfqIds) : Promise.resolve(new Map()),\n    needsPreview || needsSummary\n      ? fetchItemsPreviewData(env, rfqIds)\n      : Promise.resolve({ previewMap: new Map(), summaryMap: new Map() }),\n  ]);\n\n  const previewMap = itemsData?.previewMap instanceof Map ? itemsData.previewMap : new Map();\n  const summaryMap = itemsData?.summaryMap instanceof Map ? itemsData.summaryMap : new Map();\n  const itemsCountMap = itemsData?.itemsCountMap instanceof Map ? itemsData.itemsCountMap : new Map();\n\n  // Enrich each row\n  return rows.map((row) => {\n    const next = { ...row };\n    const id = row?.id;\n\n    // Add quotations_count if missing\n    if (typeof next.quotations_count !== \"number\" && id && quotesMap.has(id)) {\n      next.quotations_count = quotesMap.get(id);\n    }\n\n    // Add items_preview if missing\n    if (!Array.isArray(next.items_preview) || next.items_preview.length === 0) {\n      next.items_preview = id && previewMap.has(id) ? previewMap.get(id) : [];\n    }\n\n    // Add items_summary if missing\n    if (!Array.isArray(next.items_summary) || next.items_summary.length === 0) {\n      const fallbackCategoryPath =\n        row?.first_category_path ?? row?.category_path ?? \"\";\n      const fetched = id && summaryMap.has(id) ? summaryMap.get(id) : [];\n      \n      // Ensure each entry has categoryPath\n      const enriched = fetched.map((entry) => ({\n        ...entry,\n        categoryPath: entry.categoryPath || fallbackCategoryPath,\n      }));\n      \n      next.items_summary = enriched;\n    }\n\n    // Add items_total_count and items_overflow_count if we have item count data\n    if (id && itemsCountMap.has(id)) {\n      const totalItems = itemsCountMap.get(id);\n      const shownItems = Array.isArray(next.items_summary) ? next.items_summary.length : 0;\n      const overflowCount = Math.max(0, totalItems - shownItems);\n      \n      next.items_total_count = totalItems;\n      if (overflowCount > 0) {\n        next.items_overflow_count = overflowCount;\n      }\n    }\n\n    return next;\n  });\n}\n\n", "\n", "// hubgate-api/src/services/sellerRfqService.js\nimport { supaGETWithUser } from \"../lib/supabase.js\";\nimport { mapSellerRfqCard } from \"../mappers/sellerRfqCardMapper.js\";\nimport { enrichRfqCardRows } from \"../enrichment/enrichRfqCardRows.js\";\nimport { mapSellerHydrate } from \"../mappers/sellerHydrateMapper.js\";\n\nexport async function fetchSellerRfqList(env, bearerToken, queryString) {\n  try {\n    const { status, json } = await supaGETWithUser(\n      env,\n      \"v_rfqs_card\",\n      queryString,\n      bearerToken\n    );\n\n    if (status >= 400) {\n      return { error: { status, details: json } };\n    }\n\n    const rows = Array.isArray(json) ? json : [];\n    \n    // Enrich rows (adds items_preview/items_summary if missing)\n    const enriched = await enrichRfqCardRows(env, rows);\n    \n    // Map to camelCase DTO\n    const mapped = enriched.map(mapSellerRfqCard);\n\n    return { rows: mapped };\n  } catch (e) {\n    return { error: { message: String(e) } };\n  }\n}\n\nexport async function hydrateSellerRfq(env, bearer, rfqId, sellerId) {\n  const url = `${env.SUPABASE_URL}/rest/v1/rpc/rfq_hydrate_seller`;\n\n  const payload = {\n  _rfq_id: rfqId,\n  _seller_id: sellerId\n};\n\n  const res = await fetch(url, {\n    method: \"POST\",\n    headers: {\n      \"apikey\": env.SUPABASE_SERVICE_ROLE,\n      \"Authorization\": `Bearer ${bearer}`,\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(payload)\n  });\n\n  const json = await res.json().catch(() => null);\n\n  if (!res.ok) {\n    return { error: { status: res.status, body: json } };\n  }\n\n  // Map the RPC response to ensure location field is normalized\n  const mapped = mapSellerHydrate(json);\n\n  return { data: mapped };\n}", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/Users/hamzanazzal/Desktop/fecro.ae/hubgate-api/.wrangler/tmp/bundle-4PRCGm/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/opt/homebrew/lib/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/Users/hamzanazzal/Desktop/fecro.ae/hubgate-api/.wrangler/tmp/bundle-4PRCGm/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/Users/hamzanazzal/Desktop/fecro.ae/hubgate-api/.wrangler/tmp/bundle-4PRCGm/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/Users/hamzanazzal/Desktop/fecro.ae/hubgate-api/src/index.js\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/opt/homebrew/lib/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/opt/homebrew/lib/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/Users/hamzanazzal/Desktop/fecro.ae/hubgate-api/src/index.js\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "// hubgate-api/src/index.js\n\nimport { ok } from \"./utils/response.js\";\nimport { corsHeaders, allowOrigin, unauthorized } from \"./utils/cors.js\";\nimport { requireAdmin, inviteUserByEmail } from \"./lib/auth.js\";\n//import { listSellerRFQs } from \"./handlers/seller.js\";\nimport { listSellerRFQs, hydrateSellerRFQ } from \"./handlers/seller.js\";\n\nimport {\n  createCompany,\n  inviteCompanyUser,\n  acceptCompanyInvite,\n  getMe,\n  getCompanyInvite,\n} from \"./handlers/company.js\";\nimport {\n  listBuyerRFQs,\n  getBuyerRFQ,\n} from \"./handlers/buyerRfq\";\n\n\nexport default {\n  async fetch(req, env) {\n    const url = new URL(req.url);\n    const origin = req.headers.get(\"origin\") || \"\";\n    const acao = allowOrigin(origin, env);\n\nconsole.log(\"PATH=\", url.pathname);\n\n    // CORS preflight\n    if (req.method === \"OPTIONS\") {\n      return new Response(null, { headers: corsHeaders(acao) });\n    }\n\n    // Health\n    if (\n      url.pathname === \"/api/health\" ||\n      url.pathname === \"/health\" ||\n      url.pathname === \"/healthz\"\n    ) {\n      return ok({ ok: true, service: \"hubgate-api\", ts: Date.now() }, corsHeaders(acao));\n    }\n\n    // Auth redirect passthrough\n    if (url.pathname === \"/auth/redirect\") {\n      const forward = new URL(\"https://app.hubgate.ae/auth/callback\");\n      for (const [k, v] of url.searchParams) forward.searchParams.set(k, v);\n      return Response.redirect(forward.toString(), 302);\n    }\n\n    // --- Admin routes (kept here; not moved yet) ---\n     if (url.pathname === \"/admin/whoami\" && req.method === \"GET\") {\n      const isAdmin = await requireAdmin(req, env);\n      if (!isAdmin) return unauthorized(acao);\n      return ok({ ok: true, role: \"SuperAdmin\" }, corsHeaders(acao));\n    }\n\n    if (url.pathname === \"/admin/users.invite\" && req.method === \"POST\") {\n      const isAdmin = await requireAdmin(req, env);\n      if (!isAdmin) return unauthorized(acao);\n\n      const payload = await req.json().catch(() => ({}));\n      \n      const email = String(payload.email || \"\").trim().toLowerCase();\n      const roles = Array.isArray(payload.roles) ? payload.roles : [];\n\n      if (!email) {\n        return new Response(JSON.stringify({ error: \"email required\" }), {\n          status: 400,\n          headers: { \"content-type\": \"application/json\", ...corsHeaders(acao) },\n        });\n      }\n\n      const { status, body } = await inviteUserByEmail(env, email, roles);\n      return new Response(JSON.stringify({ status, result: body }), {\n        status,\n        headers: { \"content-type\": \"application/json\", ...corsHeaders(acao) },\n      });\n    }\n\n      if (url.pathname === \"/admin/debug/supabase-host\" && req.method === \"GET\") {\n      const isAdmin = await requireAdmin(req, env);\n      if (!isAdmin) return unauthorized(acao);\n      let host = \"BAD_URL\";\n      try { host = new URL(env.SUPABASE_URL).host; } catch {}\n      return ok({ supabaseHost: host }, corsHeaders(acao));\n    }\n\n    // --- Buyer RFQs ---\n\n    if (url.pathname === \"/buyer/rfqs\" && req.method === \"GET\") {\n      return listBuyerRFQs(req, env, acao);\n    }\n\n    if (url.pathname.startsWith(\"/buyer/rfq/\") && req.method === \"GET\") {\n      return getBuyerRFQ(req, env, acao);\n    }\n\n    // --- Seller ---\n    if (url.pathname === \"/seller/rfqs\" && req.method === \"GET\") {\n      return listSellerRFQs(req, env, acao);\n    }\n    if (url.pathname === \"/seller/rfq/hydrate\" && req.method === \"GET\") {\n  return hydrateSellerRFQ(req, env, acao);\n}\n\n    // --- Company ---\n    if (url.pathname === \"/company/create\" && req.method === \"POST\") {\n      return createCompany(req, env, acao);\n    }\n    if (url.pathname === \"/company/invite\" && req.method === \"POST\") {\n      return inviteCompanyUser(req, env, acao);\n    }\n    if (url.pathname === \"/company/accept\" && req.method === \"POST\") {\n      return acceptCompanyInvite(req, env, acao);\n    }\n    if (url.pathname.startsWith(\"/company/invite/\") && req.method === \"GET\") {\n      return getCompanyInvite(req, env, acao);\n    }\n\n    // --- User ---\n    if (url.pathname === \"/me\" && req.method === \"GET\") {\n      return getMe(req, env, acao);\n    }\n\n    // Fallback\n    return new Response(\"Not Found\", { status: 404, headers: corsHeaders(acao) });\n  },\n};", "// hubgate-api/src/utils/response.js\nimport { corsHeaders } from \"./cors.js\";\n\nexport function ok(data, extra = {}) {\n  return new Response(JSON.stringify(data), {\n    status: 200,\n    headers: {\n      \"content-type\": \"application/json\",\n      \"cache-control\": \"no-store\",\n      ...extra,\n    },\n  });\n}\n\nexport function jsonResponse(data, status = 200, origin = \"\") {\n  return new Response(JSON.stringify(data), {\n    status,\n    headers: { \"content-type\": \"application/json\", ...corsHeaders(origin) },\n  });\n}", "// hubgate-api/src/utils/cors.js\nexport function corsHeaders(origin) {\n  return {\n    \"access-control-allow-origin\": origin,\n    \"access-control-allow-methods\": \"GET,POST,OPTIONS\",\n    \"access-control-allow-headers\": \"authorization,content-type\",\n    \"vary\": \"origin\",\n  };\n}\n\nexport function allowOrigin(origin, env) {\n  const allow = String(env.CORS_ALLOWED_ORIGINS || \"\")\n    .split(\",\")\n    .map(s => s.trim())\n    .filter(Boolean);\n  return allow.includes(origin) ? origin : \"\";\n}\n\nexport function unauthorized(origin = \"\") {\n  return new Response(JSON.stringify({ error: \"unauthorized\" }), {\n    status: 401,\n    headers: { \"content-type\": \"application/json\", ...corsHeaders(origin) },\n  });\n}", "// hubgate-api/src/lib/auth.js\n\nimport { corsHeaders } from \"../utils/cors.js\";\n\n// Base64URL \u2192 string (keep if still needed elsewhere)\nexport function b64urlToStr(s) {\n  s = s.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const pad = s.length % 4 ? 4 - (s.length % 4) : 0;\n  if (pad) s += \"=\".repeat(pad);\n  return new TextDecoder().decode(Uint8Array.from(atob(s), c => c.charCodeAt(0)));\n}\n\nexport async function requireAdmin(req, env) {\n  const hdr = req.headers.get(\"authorization\") || \"\";\n  const token = hdr.toLowerCase().startsWith(\"bearer \") ? hdr.slice(7) : \"\";\n  return token && token === env.ADMIN_BEARER;\n}\n\nexport async function getCompanyIdForUser(env, userId) {\n  const url = `${env.SUPABASE_URL}/rest/v1/company_memberships?user_id=eq.${userId}&select=company_id&limit=1`;\n  const res = await fetch(url, {\n    headers: {\n      apikey: env.SUPABASE_SERVICE_KEY,\n      authorization: `Bearer ${env.SUPABASE_SERVICE_KEY}`,\n      accept: \"application/json\",\n    },\n  });\n  if (!res.ok) return null;\n  const data = await res.json();\n  return Array.isArray(data) && data.length > 0 ? data[0].company_id : null;\n}\n\nexport async function requireUser(req, env, acao = \"\") {\n  const hdr = req.headers.get(\"authorization\") || \"\";\n  const token = hdr.startsWith(\"Bearer \") ? hdr.slice(7) : \"\";\n  if (!token) {\n    return {\n      ok: false,\n      res: new Response(JSON.stringify({ error: \"missing_bearer\" }), {\n        status: 401,\n        headers: {\n          \"content-type\": \"application/json\",\n          ...corsHeaders(acao),\n        },\n      }),\n    };\n  }\n\n  const r = await fetch(`${env.SUPABASE_URL}/auth/v1/user`, {\n    headers: { apikey: env.SUPABASE_ANON_KEY, authorization: `Bearer ${token}` },\n  });\n\n  if (!r.ok) {\n    return {\n      ok: false,\n      res: new Response(JSON.stringify({ error: \"invalid_token\" }), {\n        status: 401,\n        headers: {\n          \"content-type\": \"application/json\",\n          ...corsHeaders(acao),\n        },\n      }),\n    };\n  }\n\n  const user = await r.json();\n\n  // Attach company_id from company_memberships (via service key)\n  const company_id = await getCompanyIdForUser(env, user.id);\n  if (company_id) user.company_id = company_id;\n\n  return { ok: true, user };\n}\n\nexport function hasSellerRole(user) {\n  const roles =\n    user?.user_metadata?.roles ||\n    user?.app_metadata?.roles ||\n    [];\n  return Array.isArray(roles) && roles.includes(\"seller\");\n}\n\nexport async function inviteUserByEmail(env, email, roles = []) {\n  const url = `${env.SUPABASE_URL}/auth/v1/invite`;\n  const body = JSON.stringify({\n    email,\n    data: { roles }, // stored as user_metadata.roles\n    redirect_to: \"https://api.hubgate.ae/auth/redirect\",\n  });\n  const res = await fetch(url, {\n    method: \"POST\",\n    headers: {\n      \"content-type\": \"application/json\",\n      apikey: env.SUPABASE_SERVICE_KEY,\n      authorization: `Bearer ${env.SUPABASE_SERVICE_KEY}`,\n    },\n    body,\n  });\n  const text = await res.text();\n  let json; try { json = JSON.parse(text); } catch { json = { raw: text }; }\n  return { status: res.status, body: json };\n}\n\nexport async function getUserIdFromJWT(req, env) {\n  const hdr = req.headers.get(\"authorization\") || \"\";\n  if (!/^bearer\\s+/i.test(hdr)) return null;\n  const token = hdr.slice(7);\n  const resp = await fetch(`${env.SUPABASE_URL}/auth/v1/user`, {\n    headers: {\n      apikey: env.SUPABASE_SERVICE_KEY, // service or anon both fine here\n      authorization: `Bearer ${token}`,\n    },\n  });\n  if (!resp.ok) return null;\n  const json = await resp.json();\n  return json?.id || null;\n}\n\n", "// hubgate-api/src/handlers/seller.js\nimport { requireUser } from \"../lib/auth.js\";\nimport { supaGETWithUser } from \"../lib/supabase.js\";\nimport { fetchSellerRfqList } from \"../services/sellerRfqService.js\";\nimport { ok, jsonResponse } from \"../utils/response.js\";\nimport { corsHeaders } from \"../utils/cors.js\";\n\nexport async function listSellerRFQs(req, env, acao) {\n  // Auth check (same pattern as buyerRfq.js)\n  const authCheck = await requireUser(req, env);\n  if (!authCheck.ok) return authCheck.res;\n  const sellerCompanyId = authCheck.user.company_id;\n\n  // Validate that sellerCompanyId exists\n  if (!sellerCompanyId) {\n    return jsonResponse(\n      { error: \"missing_company_id\", message: \"User must be associated with a company\" },\n      403,\n      acao\n    );\n  }\n\n  const url = new URL(req.url);\n\n  try {\n    // Extract pagination params\n    const page = Math.max(1, Number(url.searchParams.get(\"page\") || 1));\n    const pageSize = Math.max(1, Math.min(100, Number(url.searchParams.get(\"pageSize\") || 20)));\n    const offset = (page - 1) * pageSize;\n\n    // Build select columns (only columns that exist in v_rfqs_card view)\n    // items_preview, items_summary, and quotations_count don't exist in the view - enrichment will fetch them\n    const selectCols = [\n      \"id\",\n      \"public_id\",\n      \"seller_rfq_id\",\n      \"buyer_id\",\n      \"buyer_company_id\",\n      \"status\",\n      \"created_at\",\n      \"title\",\n      \"first_category_path\",\n      \"items_count\",\n      \"company_city\",\n      \"company_state\",\n      \"company_country\",\n    ].join(\",\");\n\n    // Build query string (URLSearchParams, not object)\n    const qp = new URLSearchParams();\n    qp.set(\"select\", selectCols);\n    qp.set(\"status\", \"eq.active\"); // Only active RFQs for sellers\n    qp.set(\"buyer_company_id\", `neq.${sellerCompanyId}`);\n    qp.set(\"order\", \"created_at.desc\");\n    qp.set(\"limit\", String(pageSize));\n    qp.set(\"offset\", String(offset));\n\n    // Extract bearer token from request headers\n    const bearer = (req.headers.get(\"authorization\") || \"\").replace(/^Bearer\\s+/i, \"\");\n    if (!bearer) {\n      return jsonResponse({ error: \"unauthorized\" }, 401, acao);\n    }\n\n    // Call service with query string and bearer token\n    const result = await fetchSellerRfqList(env, bearer, qp.toString());\n\n    if (result.error) {\n      console.error(\"Seller RFQ service error:\", result.error);\n      return jsonResponse(\n        { error: \"upstream_error\", details: result.error },\n        result.error.status || 500,\n        acao\n      );\n    }\n\n    // Return success response\n    return ok(\n      {\n        page,\n        pageSize,\n        count: result.rows.length,\n        rows: result.rows,\n      },\n      corsHeaders(acao)\n    );\n  } catch (e) {\n    console.error(\"seller/rfqs crash:\", e && (e.stack || e.message || e));\n    return jsonResponse(\n      { error: \"worker_crash\", message: String(e) },\n      500,\n      acao\n    );\n  }\n}\n\nexport async function hydrateSellerRFQ(req, env, acao) {\n  // 1) Auth\n  const authCheck = await requireUser(req, env);\n  if (!authCheck.ok) return authCheck.res;\n\n  const url = new URL(req.url);\n  const id = url.searchParams.get(\"id\");\n  const sellerId = url.searchParams.get(\"sellerId\");\n\n  if (!id || !sellerId) {\n    return jsonResponse(\n      { error: \"missing_parameters\", details: { id, sellerId } },\n      400,\n      acao\n    );\n  }\n\n  // Extract bearer token\n  const bearer = (req.headers.get(\"authorization\") || \"\").replace(/^Bearer\\s+/i, \"\");\n  if (!bearer) {\n    return jsonResponse({ error: \"unauthorized\" }, 401, acao);\n  }\n\n  // 2) Call service\n  try {\n    const { hydrateSellerRfq } = await import(\"../services/sellerRfqService.js\");\n\n    const result = await hydrateSellerRfq(env, bearer, id, sellerId);\n\n    if (result.error) {\n      console.error(\"hydrateSellerRFQ error:\", result.error);\n      return jsonResponse(\n        { error: \"upstream_error\", details: result.error },\n        result.error.status || 500,\n        acao\n      );\n    }\n\n    return ok(result.data, corsHeaders(acao));\n  } catch (e) {\n    console.error(\"hydrateSellerRFQ crash:\", e);\n    return jsonResponse(\n      { error: \"worker_crash\", message: String(e) },\n      500,\n      acao\n    );\n  }\n}", "// hubgate-api/src/handlers/company.js\n\nimport { ok, jsonResponse } from \"../utils/response.js\";\nimport { corsHeaders } from \"../utils/cors.js\";\nimport { requireUser } from \"../lib/auth.js\";\nimport { supaPOSTService, supaGETService, supaPATCHService } from \"../lib/supabase.js\";\n\n\nexport async function createCompany(req, env, acao) {\n  const authCheck = await requireUser(req, env, acao);\n  if (!authCheck.ok) return authCheck.res;\n  const user = authCheck.user;\n  const payload = await req.json().catch(() => ({}));\n  const name = (payload?.name || \"\").trim();\n\n  if (!name) {\n    return jsonResponse({ error: \"name_required\" }, 400, acao);\n  }\n\n  // Extract optional fields and map to database columns\n  const legalName = (payload?.legalName || \"\").trim() || null;\n  const tradeLicenseNo = (payload?.tradeLicenseNo || \"\").trim() || null;\n  const country = (payload?.country || \"\").trim() || null;\n  const city = payload?.city || null;\n  const phone = (payload?.phone || \"\").trim() || null;\n\n  try {\n    const companyData = {\n      name,\n      legal_name: legalName,\n      trade_license_no: tradeLicenseNo,\n      country,\n      city,\n      phone,\n      created_by_user_id: user.id,\n    };\n\n    // Remove null values to let database use defaults\n    Object.keys(companyData).forEach(\n      (key) => companyData[key] === null && delete companyData[key]\n    );\n\n    const [company] = await supaPOSTService(env, \"companies\", companyData);\n    \n    // Keep the existing logic that inserts a row into company_memberships for the creator\n    const [m] = await supaPOSTService(env, \"company_memberships\", {\n      company_id: company.id,\n      user_id: user.id,\n      track: \"procurement\",\n      role_level: 10,\n    });\n\n    return ok(\n      { companyId: company.id, name: company.name ?? name, membershipId: m.id },\n      corsHeaders(acao)\n    );\n  } catch (e) {\n    console.error(\"company/create crash:\", e?.stack || e?.message || e);\n    return jsonResponse({ error: \"worker_crash\", message: String(e) }, 500, acao);\n  }\n}\n\nexport async function inviteCompanyUser(req, env, acao) {\n  const authCheck = await requireUser(req, env, acao);\n  if (!authCheck.ok) return authCheck.res;\n  const user = authCheck.user;\n  const { email } = await req.json().catch(() => ({}));\n\n  if (!email) return jsonResponse({ error: \"missing_email\" }, 400, acao);\n  const token = crypto.randomUUID();\n  try {\n\n    const result = await supaPOSTService(env, \"company_invites\", {\n      company_id: user.company_id,\n      email,\n      invited_by: user.id,\n      token,\n    });\n\n    const invite = Array.isArray(result) ? result[0] : result;\n    return jsonResponse({ ok: true, invite }, 200, acao);\n\n  } catch (err) {\n    return jsonResponse(\n      { error: \"invite_create_failed\", details: err.message || String(err) },\n      500,\n      acao\n    );\n  }\n}\n\nexport async function acceptCompanyInvite(req, env, acao) {\n  const authCheck = await requireUser(req, env, acao);\n  if (!authCheck.ok) return authCheck.res;\n  const user = authCheck.user;\n  try {\n    const body = await req.json().catch(() => ({}));\n    const token = (body.token || \"\").trim();\n    if (!token) return jsonResponse({ error: \"missing_token\" }, 400, acao);\n    // 1) pending invite by token\n\n    const { data: invites, error: fetchErr } = await supaGETService(\n      env, `company_invites?token=eq.${encodeURIComponent(token)}&status=eq.pending`\n    );\n    if (fetchErr) throw new Error(fetchErr.message);\n    const invite = (invites || [])[0];\n    if (!invite) return jsonResponse({ error: \"invalid_or_expired\" }, 404, acao);\n    // Email match validation\n\n    if (invite.email && user.email && invite.email.toLowerCase() !== user.email.toLowerCase()) {\n      return jsonResponse({ error: \"invite_email_mismatch\" }, 403, acao);\n    }\n    // 2) Create company membership\n\n    let membershipId;\n    try {\n      const [membership] = await supaPOSTService(env, \"company_memberships\", {\n        company_id: invite.company_id,\n        user_id: user.id,\n        track: \"sales\",\n        role_level: 10,\n      });\n      membershipId = membership.id;\n    } catch (e) {\n      const msg = String(e.message || e);\n      const isDuplicate = msg.includes('\"code\":\"23505\"') || msg.includes(\"company_memberships_company_id_user_id_key\");\n      if (!isDuplicate) throw e;\n      // already a member \u2192 look it up\n      const { data: existing } = await supaGETService(\n        env,\n        `company_memberships?company_id=eq.${encodeURIComponent(invite.company_id)}&user_id=eq.${encodeURIComponent(user.id)}&select=id&limit=1`\n      );\n      membershipId = existing?.[0]?.id || null;\n    }\n    // 3) Mark invite as accepted (even if duplicate)\n\n    await supaPATCHService(env, \"company_invites\", invite.id, {\n      status: \"accepted\",\n      accepted_at: new Date().toISOString(),\n    });\n    return jsonResponse(\n\n      { ok: true, company_id: invite.company_id, membership_id: membershipId },\n      200,\n      acao\n    );\n  } catch (err) {\n    return jsonResponse({ error: \"worker_crash\", message: String(err) }, 500, acao);\n  }\n}\n\n// Get current user info with company_id\nexport async function getMe(req, env, acao) {\n  const authCheck = await requireUser(req, env, acao);\n  if (!authCheck.ok) return authCheck.res;\n  const user = authCheck.user;\n  \n  // requireUser already attaches company_id to user object\n  return jsonResponse(\n    {\n      user: {\n        id: user.id,\n        email: user.email,\n        user_metadata: user.user_metadata,\n      },\n      company_id: user.company_id || null,\n    },\n    200,\n    acao\n  );\n}\n\n// Public endpoint to get invite details by token (minimal info only)\nexport async function getCompanyInvite(req, env, acao) {\n  try {\n    const url = new URL(req.url);\n    const token = url.pathname.split(\"/\").pop(); // Extract token from /company/invite/:token\n    \n    if (!token || token === \"invite\") {\n      return jsonResponse({ error: \"missing_token\" }, 400, acao);\n    }\n\n    // Fetch invite using service key (public endpoint, no auth required)\n    const { data: invites, error: fetchErr } = await supaGETService(\n      env,\n      `company_invites?token=eq.${encodeURIComponent(token)}&select=email,company_id,status`\n    );\n    \n    if (fetchErr) throw new Error(fetchErr.message);\n    const invite = Array.isArray(invites) && invites.length > 0 ? invites[0] : null;\n    \n    if (!invite) {\n      return jsonResponse({ error: \"invalid_or_expired\" }, 404, acao);\n    }\n\n    // Fetch company name\n    let companyName = null;\n    if (invite.company_id) {\n      const { data: companies, error: companyErr } = await supaGETService(\n        env,\n        `companies?id=eq.${encodeURIComponent(invite.company_id)}&select=name&limit=1`\n      );\n      if (!companyErr && Array.isArray(companies) && companies.length > 0) {\n        companyName = companies[0].name;\n      }\n    }\n\n    // Return minimal info only\n    return jsonResponse(\n      {\n        email: invite.email,\n        companyName,\n        status: invite.status,\n      },\n      200,\n      acao\n    );\n  } catch (err) {\n    return jsonResponse({ error: \"worker_crash\", message: String(err) }, 500, acao);\n  }\n}\n", "// hubgate-api/src/handlers/buyerRfq.js\n\nimport { requireUser } from \"../lib/auth\";\nimport { supaGETWithUser } from \"../lib/supabase\";\nimport { ok, jsonResponse } from \"../utils/response\";\nimport { corsHeaders } from \"../utils/cors\";\n\n// GET /buyer/rfqs\nexport async function listBuyerRFQs(req, env, acao) {\n  const authCheck = await requireUser(req, env);\n  if (!authCheck.ok) return authCheck.res;\n\n  const url = new URL(req.url);\n\n  try {\n    const page = Math.max(1, Number(url.searchParams.get(\"page\") || 1));\n    const pageSize = Math.max(\n      1,\n      Math.min(100, Number(url.searchParams.get(\"pageSize\") || 20))\n    );\n    const offset = (page - 1) * pageSize;\n\n    const selectCols = [\n      \"id\",\n      \"public_id\",\n      \"seller_rfq_id\",\n      \"buyer_id\",\n      \"buyer_company_id\",\n      \"status\",\n      \"created_at\",\n      \"title\",\n      \"first_category_path\",\n      \"items_count\",\n      \"items_preview\",\n      \"company_city\",\n      \"company_state\",\n      \"company_country\",\n    ].join(\",\");\n\n    const qp = new URLSearchParams();\n    qp.set(\"select\", selectCols);\n    qp.set(\"status\", \"eq.active\");\n    qp.set(\"order\", \"created_at.desc\");\n    qp.set(\"limit\", String(pageSize));\n    qp.set(\"offset\", String(offset));\n\n    const bearer = (req.headers.get(\"authorization\") || \"\").replace(\n      /^Bearer\\s+/i,\n      \"\"\n    );\n    if (!bearer) {\n      return jsonResponse({ error: \"unauthorized\" }, 401, acao);\n    }\n\n    const { status, json } = await supaGETWithUser(\n      env,\n      \"v_rfqs_card\",\n      qp.toString(),\n      bearer\n    );\n\n    if (status >= 400) {\n      console.error(\"Supabase REST error (buyer/rfqs)\", status, json);\n      return jsonResponse(\n        { error: \"upstream_error\", status, details: json },\n        status,\n        acao\n      );\n    }\n\n    const rows = Array.isArray(json) ? json : [];\n    return ok(\n      { page, pageSize, count: rows.length, rows },\n      corsHeaders(acao)\n    );\n  } catch (e) {\n    console.error(\"buyer/rfqs crash:\", e && (e.stack || e.message || e));\n    return jsonResponse(\n      { error: \"worker_crash\", message: String(e) },\n      500,\n      acao\n    );\n  }\n}\n\n// GET /buyer/rfq/:id  (id = internal RFQ UUID, like existing buyer detail)\nexport async function getBuyerRFQ(req, env, acao) {\n  const authCheck = await requireUser(req, env);\n  if (!authCheck.ok) return authCheck.res;\n\n  const url = new URL(req.url);\n  const pathname = url.pathname || \"\";\n  const parts = pathname.split(\"/\").filter(Boolean);\n  const rfqId = parts[2]; // /buyer/rfq/:id \u2192 [\"buyer\",\"rfq\",\":id\"]\n\n  if (!rfqId) {\n    return jsonResponse({ error: \"missing_rfq_id\" }, 400, acao);\n  }\n\n  try {\n    const selectCols = [\n      \"id\",\n      \"public_id\",\n      \"seller_rfq_id\",\n      \"buyer_id\",\n      \"buyer_company_id\",\n      \"status\",\n      \"created_at\",\n      \"title\",\n      \"first_category_path\",\n      \"items_count\",\n      \"items_preview\",\n      \"company_city\",\n      \"company_state\",\n      \"company_country\",\n    ].join(\",\");\n\n    const qp = new URLSearchParams();\n    qp.set(\"select\", selectCols);\n    qp.set(\"id\", `eq.${rfqId}`);\n    qp.set(\"limit\", \"1\");\n\n    const bearer = (req.headers.get(\"authorization\") || \"\").replace(\n      /^Bearer\\s+/i,\n      \"\"\n    );\n    if (!bearer) {\n      return jsonResponse({ error: \"unauthorized\" }, 401, acao);\n    }\n\n    const { status, json } = await supaGETWithUser(\n      env,\n      \"v_rfqs_card\",\n      qp.toString(),\n      bearer\n    );\n\n    if (status >= 400) {\n      console.error(\"Supabase REST error (buyer/rfq)\", status, json);\n      return jsonResponse(\n        { error: \"upstream_error\", status, details: json },\n        status,\n        acao\n      );\n    }\n\n    const rows = Array.isArray(json) ? json : [];\n    const rfq = rows[0] || null;\n\n    if (!rfq) {\n      return jsonResponse({ error: \"not_found\" }, 404, acao);\n    }\n\n    return jsonResponse({ rfq }, 200, acao);\n  } catch (e) {\n    console.error(\"buyer/rfq crash:\", e && (e.stack || e.message || e));\n    return jsonResponse(\n      { error: \"worker_crash\", message: String(e) },\n      500,\n      acao\n    );\n  }\n}", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n"],
  "mappings": "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",
  "names": ["hydrateSellerRfq"]
}
